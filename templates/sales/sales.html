{% extends 'base/base_nav_footer.html' %}

{% load static %}

{% block page_title %}
{{ page_title }}
{% endblock %}


{% block content %}
<div class="container-fluid container-sales">
  <div class="row">
    <div class="col-xs-6">
      <div class="text-xs-center">
        <p>Ganancias totales: <span id="total-earnings-text" class="font-weight-bold">$ </span></p>
      </div>
    </div>
    <div class="col-xs-6">
      <div class="row">
        <div class="col-xs-4">
        </div>
        <div class="col-xs-4">
          <p class="float-xs-right">Hoy es: <span class="font-weight-bold">{{ day }}</span></p>
        </div>
        <div class="col-xs-4">
          <p class="float-xs-right">Semana: <span class="font-weight-bold">{{ week }}</span></p>
        </div>
      </div>
    </div>
    <div class="col-xs-12 col-md-6">
      <div class="canvas-holder">
        <canvas id="canvas-week-sales"></canvas>
      </div>
    </div>
    <div class="col-xs-12 col-md-6">
      <div class="canvas-holder">
        <canvas id="canvas-day-sales"></canvas>
      </div>
    </div>
  </div>

</div>
{% endblock content %}

{% block javascript %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.4.0/Chart.bundle.min.js"></script>
<script type="text/javascript" charset="utf-8">
  var ctx_week = document.getElementById("canvas-week-sales");
  var ctx_day = document.getElementById("canvas-day-sales");
  var earnings = JSON.parse('{{ earnings|safe }}');

  var earnings_for_the_week = new Chart(ctx_week, {
    type: 'bar',
    data: {
      labels: ["Lunes", "Martes", "Miercoles", "Jueves", "Viernes", "Sábado", "Domingo"],
      datasets: [{
        label: 'Ventas del día',
        data: earnings,
        backgroundColor: [
        'rgba(241,196,15,0.7)',
        'rgba(230,126,34,0.7)',
        'rgba(231,76,60,0.7)',
        'rgba(26,188,156,0.7)',
        'rgba(46,204,113,0.7)',
        'rgba(52,152,219,0.7)',
        'rgba(52,73,94,0.7)',
        ],
        borderColor: [
        'rgba(241,196,15,0.9)',
        'rgba(230,126,34,0.9)',
        'rgba(231,76,60,0.9)',
        'rgba(26,188,156,0.9)',
        'rgba(46,204,113,0.9)',
        'rgba(52,152,219,0.9)',
        'rgba(52,73,94,0.9)',
        ],
        borderWidth: 1
      }]
    },
    options: {
      responsive: true,
      scales: {
        yAxes: [{
          ticks: {
            beginAtZero:true
          }
        }]
      }
    }
  });

  var earnings_for_the_day = new Chart(ctx_day, {
    type: 'bar',
    data: {
      labels: [
      "05:00 - 05:30","06:00 - 07:00","07:00 - 08:00","08:00 - 09:00","09:00 - 10:00","10:00 - 11:00","11:00 - 12:00","12:00 - 13:00",
      "05:00 - 06:00","06:00 - 07:00","07:00 - 08:00","08:00 - 09:00","09:00 - 10:00","10:00 - 11:00","11:00 - 12:00","12:00 - 13:00",
      ],
      datasets: [{
        label: 'Ventas en este horario',
        data: [90, 60, 20, 100, 20, 5, 055, 40,90, 60, 20, 100, 20, 5, 055, 40],
        backgroundColor: [
        'rgba(242,38,19,0.7)',
        'rgba(246,36,89,0.7)',
        'rgba(103,65,114,0.7)',
        'rgba(65,131,215,0.7)',
        'rgba(54,215,183,0.7)',
        'rgba(46,204,113,0.7)',
        'rgba(247,202,24,0.7)',
        'rgba(249,105,14,0.7)','rgba(242,38,19,0.7)',
        'rgba(246,36,89,0.7)',
        'rgba(103,65,114,0.7)',
        'rgba(65,131,215,0.7)',
        'rgba(54,215,183,0.7)',
        'rgba(46,204,113,0.7)',
        'rgba(247,202,24,0.7)',
        'rgba(249,105,14,0.7)',
        ],
        borderWidth: 0
      }]
    },
    options: {
      responsive: true,
      scales: {
        yAxes: [{
          ticks: {
            beginAtZero:true
          }
        }]
      }
    }
  });

  /** Funciona para darle formato de moneda a un numero */
  function set_number_format(amount, decimals) {
    amount += ''; 
    amount = parseFloat(amount.replace(/[^0-9\.]/g, '')); 
    decimals = decimals || 0;

    if (isNaN(amount) || amount === 0) 
      return parseFloat(0).toFixed(decimals);

    amount = '' + amount.toFixed(decimals);
    var amount_parts = amount.split('.'),
    regexp = /(\d+)(\d{3})/;

    while (regexp.test(amount_parts[0]))
      amount_parts[0] = amount_parts[0].replace(regexp, '$1' + ' ' + '$2');

    return amount_parts.join('.');
  }

  /** Calcula el total de ganancias de la semana y lo imprime */
  function set_total_earnings() {
    var total_earnings = 0;

    for (var i = 0; i < earnings.length; i++ ){
      total_earnings += earnings[i];
    }

    total_earnings = set_number_format(total_earnings, 2)

    $('#total-earnings-text').append(total_earnings)

  }



  set_total_earnings();
</script>
{% endblock javascript %}
